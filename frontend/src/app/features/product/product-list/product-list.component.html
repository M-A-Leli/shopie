<app-header></app-header>

<div class="product-listing">
  <div class="error-container" *ngIf="errorMessage">{{ errorMessage }}</div>
  <div class="success-container" *ngIf="successMessage">{{ successMessage }}</div>

  <div class="filters">
    <label for="category">Select Category:
      <select id="category" [(ngModel)]="selectedCategoryId" (change)="filterByCategory()">
        <option value="">All Categories</option>
        <option *ngFor="let category of categories" [value]="category.id">
          {{ category.name }}
        </option>
    </select>
  </label>
  </div>

  <div class="product-grid">
    <div class="product-card" *ngFor="let product of paginatedProducts" (click)="viewProduct(product.id || '')">
      <div class="product-img">
        <img [src]="product.images[0].url" alt="{{ product.name }}">
        <!-- <img src="/product_placeholder.svg" alt="{{ product.name }}"> -->
      </div>
      <div class="product-details">
        <h3>{{ product.name }}</h3>
        <div class="rating">
          <ng-container *ngFor="let star of getRatingArray(product.rating || 0); let i = index">
            <i class="fa" [ngClass]="star"></i>
          </ng-container>
          <p>({{ product.no_of_reviews }})</p>
        </div>
        <p class="price">${{ product.price }}</p>
        <p>{{ product.stock_quantity !== 0 ? 'in stock' : 'out of stock' }}</p>
      </div>
      <div class="action-buttons">
        <button (click)="addToCart($event, product.id || '')">Add to Cart</button>
      </div>
    </div>
  </div>

  <div class="pagination">
    <button (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
    <button *ngFor="let page of totalPagesArray" (click)="goToPage(page)">{{ page }}</button>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
  </div>
</div>

<app-footer></app-footer>
